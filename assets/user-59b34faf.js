import{u as J,a as m}from"./users-f70a1bed.js";import{d as K,a as P,r as v,b as s,c as h,e as k,f as o,w as u,F as T,o as f,g as x,h as $,E as b,i as Q,u as y,t as R,j}from"./index-f8526ca3.js";const W=K("groups",{state:()=>({groups:[]}),getters:{getGroupUsers_uuid:d=>i=>d.groups.find(a=>a.uuid==i).users_uuid,getTxByUuid:d=>i=>d.groups.find(a=>a.uuid==i).n_tx},actions:{setGroups(d){this.groups=d},setTxByUuid(d,i){let a=this.groups.findIndex(_=>_.uuid==d);this.groups[a].n_tx=i}}}),X={class:"demo-collapse"},Y={key:0},Z={key:1},at=P({__name:"user",setup(d){const i=v([]),a=J(),_=W(),r=a.getUUID;let D=[];const w=async()=>{await m.getUsers({},r).then(function(t){S.value=t.data.filter(e=>e.uuid!=a.getUUID).map(e=>({key:e.uuid,label:e.account})),a.setOthers(t.data)}).catch(function(t){console.log(t)}),await m.getInfo({},r).then(function(t){t.data.forEach(n=>{n.data.sort((c,p)=>c.num-p.num)}),A.value=t.data;let e=[];for(let n=0;n<t.data.length;n++){let c=t.data[n].guuid,p=[];for(let U=0;U<t.data[n].data.length;U++)p.push(t.data[n].data[U].useruuid);e.push({uuid:c,n_tx:t.data[n].txuuid,users_uuid:p}),D.push(!1)}_.setGroups(e)}).catch(function(t){console.log(t)}),await m.getConfirm({},r).then(function(t){console.log(t.data),i.value=t.data.map(e=>({time:e.time,members:_.getGroupUsers_uuid(e.guuid).map(n=>a.searchAccount(n)).join(" "),account:a.searchAccount(e.useruuid),txuuid:e.txuuid,radio:1}))}).catch(function(t){console.log(t)})};w();const I=v(["1"]),E=t=>{console.log(t)},S=v([]),V=v([]),G=async t=>{console.log(t.radio,t.txuuid),t.radio==1?await m.confirm({txuuid:t.txuuid},r).then(function(e){b("确认成功"),w()}).catch(function(e){console.log(e)}):await m.cancel({txuuid:t.txuuid},r).then(function(e){b("拒绝成功"),w()}).catch(function(e){console.log(e)})},F=()=>{m.add({uuids:V.value},r).then(function(t){b("创建成功")}).catch(function(t){console.log(t)})},A=v([]),L=async t=>{await m.addTx({guuid:t},r).then(function(e){b("取外卖成功"),console.log(e.data),_.setTxByUuid(t,e.data)}).catch(function(e){console.log(e)})},M=async t=>{_.getTxByUuid(t)==""?b("请先点击取外卖"):await m.getConfirmState({txuuid:_.getTxByUuid(t)},r).then(function(e){let n=e.data.map(c=>a.searchAccount(c)).join(" ");b(n)}).catch(function(e){console.log(e)})};return(t,e)=>{const n=s("el-transfer"),c=s("el-button"),p=s("el-row"),U=s("el-collapse-item"),O=s("el-collapse"),C=s("el-table-column"),N=s("el-radio"),q=s("el-radio-group"),z=s("el-table");return f(),h(T,null,[k("div",null,[o(n,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),data:S.value,"target-order":"push"},null,8,["modelValue","data"])]),k("div",null,[o(p,{class:"create_bt"},{default:u(()=>[o(c,{type:"primary",plain:"",onClick:F},{default:u(()=>[x("提交")]),_:1})]),_:1})]),k("div",X,[o(O,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=l=>I.value=l),onChange:E},{default:u(()=>[(f(!0),h(T,null,$(A.value,(l,g)=>(f(),Q(U,{title:"下一位："+y(a).searchAccount(l.next),name:g,key:g},{default:u(()=>[(f(!0),h(T,null,$(l.data,(B,H)=>(f(),h("text",{key:H},R(y(a).searchAccount(B.useruuid)+" "),1))),128)),l.next==y(a).getUUID?(f(),h("div",Y,[o(c,{disabled:y(D)[g],onClick:B=>L(l.guuid)},{default:u(()=>[x("取外卖")]),_:2},1032,["disabled","onClick"])])):j("",!0),l.next==y(a).getUUID?(f(),h("div",Z,[o(c,{onClick:B=>M(l.guuid)},{default:u(()=>[x("检查")]),_:2},1032,["onClick"])])):j("",!0)]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])]),k("div",null,[o(z,{data:i.value,style:{width:"100%"}},{default:u(()=>[o(C,{prop:"time",label:"time",width:"180"}),o(C,{prop:"members",label:"members",width:"180"}),o(C,{prop:"account",label:"account",width:"180"}),o(C,{label:"Select"},{default:u(l=>[o(q,{modelValue:l.row.radio,"onUpdate:modelValue":g=>l.row.radio=g},{default:u(()=>[o(N,{label:1},{default:u(()=>[x("同意")]),_:1}),o(N,{label:0},{default:u(()=>[x("拒绝")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(c,{onClick:g=>G(l.row)},{default:u(()=>[x("提交")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])],64)}}});export{at as default};
